// Prisma Schema for Adekis Hospital Management System
// Multi-Tenancy Support: Each hospital has isolated data

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== MULTI-TENANCY ====================

model Hospital {
  id          String   @id @default(uuid())
  name        String
  subdomain   String   @unique  // e.g., "st-marys" for st-marys.adekis.com
  address     String?
  phone       String?
  email       String?
  logo        String?
  status      String   @default("active")  // active, suspended, inactive
  
  // Branding & Configuration
  primaryColor       String   @default("#3B82F6")
  secondaryColor     String   @default("#10B981")
  accentColor        String   @default("#8B5CF6")
  fontFamily         String   @default("Inter")
  slogan             String?
  website            String?
  footerText         String?  @default("Â© 2024 Adekis Hospital Management System")
  reportHeaderImage  String?  // URL or Base64
  reportFooterImage  String?  // URL or Base64
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  users       User[]
  patients    Patient[]
  appointments Appointment[]
  prescriptions Prescription[]
  labTests     LabTest[]
  bills        Bill[]
  services     Service[]
  queueEntries QueueEntry[]
  cases        Case[]
  wards        Ward[]
  beds         Bed[]
  inventoryItems InventoryItem[]
  bloodInventory BloodInventory[]
  bloodDonors    BloodDonor[]
  bloodRequests  BloodRequest[]
  ambulances     Ambulance[]
  ambulanceRequests AmbulanceRequest[]
  ambulanceTrips AmbulanceTrip[]
  employees      Employee[]
  attendance     Attendance[]
  leaveRequests  LeaveRequest[]
  payrolls       Payroll[]
  insuranceProviders InsuranceProvider[]
  insuranceClaims    InsuranceClaim[]
  wallets            Wallet[]
  walletTransactions WalletTransaction[]
  operatingRooms     OperatingRoom[]
  surgeries          Surgery[]
  admissions         Admission[]
  medicalRecords     MedicalRecord[]
  clinicalNotes      ClinicalNote[]
  maternityPatients  MaternityPatient[]
  ancVisits          ANCVisit[]
  deliveries         Delivery[]
  newborns           Newborn[]
  pncVisits          PNCVisit[]
  labInventory       LabInventory[]
  labInventoryTransactions LabInventoryTransaction[]
  triageRecords      TriageRecord[]
  expenses           Expense[]
  medicalCamps       MedicalCamp[]
}

// ==================== WALLET & PAYMENTS ====================

model Wallet {
  id          String   @id @default(uuid())
  hospitalId  String
  patientId   String   @unique
  balance     Float    @default(0)
  currency    String   @default("KES")
  status      String   @default("active") // active, suspended
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  patient     Patient  @relation(fields: [patientId], references: [id])
  transactions WalletTransaction[]

  @@index([hospitalId])
  @@index([patientId])
}

model WalletTransaction {
  id          String   @id @default(uuid())
  hospitalId  String
  walletId    String
  type        String   // credit, debit
  amount      Float
  description String?
  reference   String?  // e.g., payment reference, bill ID
  performedBy String?  // User ID who performed the transaction
  createdAt   DateTime @default(now())

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  wallet      Wallet   @relation(fields: [walletId], references: [id])

  @@index([hospitalId])
  @@index([walletId])
}

// ==================== USERS & AUTHENTICATION ====================

model User {
  id          String   @id @default(uuid())
  hospitalId  String
  email       String   @unique
  passwordHash String
  name        String
  role        String   // Doctor, Nurse, Administrator, Pharmacist, etc.
  department  String?
  phone       String?
  status      String   @default("active")  // active, inactive
  permissions String[] // Array of permission strings
  lastLogin   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  
  @@index([hospitalId])
  @@index([email])
}

// ==================== PATIENTS ====================

model Patient {
  id          String   @id @default(uuid())
  hospitalId  String
  patientId   String   @unique  // e.g., "PAT-00123"
  name        String
  dateOfBirth DateTime
  gender      String
  phone       String?
  email       String?
  address     String?
  bloodGroup  String?
  allergies   String[] // Array of allergy strings
  emergencyContact String?
  emergencyPhone   String?
  patientCategory  String?  // OPD, IPD
  insuranceProvider String?
  insurancePolicyNo String?
  parentName      String?
  weight          String?
  height          String?
  details         Json?    // For dynamic fields like Maternity/Emergency data
  status      String   @default("active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  appointments Appointment[]
  prescriptions Prescription[]
  labTests     LabTest[]
  maternityRecords MaternityPatient[]
  triageRecords TriageRecord[]
  admissions   Admission[]
  campPatients CampPatient[]
  wallet       Wallet?
  
  @@index([hospitalId])
  @@index([patientId])
}

// ==================== APPOINTMENTS ====================

model Appointment {
  id          String   @id @default(uuid())
  hospitalId  String
  patientId   String
  doctorId    String
  appointmentDate DateTime
  appointmentTime String
  type        String   // Consultation, Follow-up, Emergency, etc.
  status      String   @default("scheduled")  // scheduled, completed, cancelled
  reason      String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  patient     Patient @relation(fields: [patientId], references: [id])
  
  @@index([hospitalId])
  @@index([patientId])
  @@index([appointmentDate])
}

// ==================== PRESCRIPTIONS ====================

model Prescription {
  id          String   @id @default(uuid())
  hospitalId  String
  patientId   String
  doctorId    String
  prescriptionId String @unique  // e.g., "RX-00456"
  medications Json     // Array of medication objects
  diagnosis   String?
  instructions String?
  status      String   @default("pending")  // pending, dispensed, cancelled
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  patient     Patient @relation(fields: [patientId], references: [id])
  
  @@index([hospitalId])
  @@index([patientId])
  @@index([prescriptionId])
}

// ==================== LABORATORY ====================

model LabTest {
  id          String   @id @default(uuid())
  hospitalId  String
  patientId   String
  testId      String   @unique  // e.g., "LAB-00789"
  testName    String
  testType    String
  orderedBy   String
  orderedByRole String?  // Doctor, Reception, EMR
  priority    String   @default("Normal")  // Normal, Urgent, STAT
  status      String   @default("pending")  // pending, in-progress, completed
  results     Json?    // Test results as JSON
  notes       String?
  resultsValidatedBy String?
  resultsValidatedAt DateTime?
  printedAt   DateTime?
  printedBy   String?
  accessLog   Json?    // Track who viewed the results
  orderedAt   DateTime @default(now())
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  patient     Patient @relation(fields: [patientId], references: [id])
  
  @@index([hospitalId])
  @@index([patientId])
  @@index([testId])
  @@index([status])
  @@index([priority])
}

// ==================== LAB INVENTORY ====================

model LabInventory {
  id            String   @id @default(uuid())
  hospitalId    String
  itemName      String
  itemCode      String   @unique
  category      String   // Reagent, Equipment, Consumable
  unit          String   // ml, pieces, kg, etc.
  quantity      Int
  minimumLevel  Int
  supplier      String?
  expiryDate    DateTime?
  costPerUnit   Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  hospital      Hospital @relation(fields: [hospitalId], references: [id])
  transactions  LabInventoryTransaction[]
  
  @@index([hospitalId])
  @@index([itemCode])
  @@index([category])
}

model LabInventoryTransaction {
  id          String   @id @default(uuid())
  hospitalId  String
  inventoryId String
  type        String   // In, Out, Adjusted
  quantity    Int
  reason      String
  performedBy String
  createdAt   DateTime @default(now())
  
  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  inventory   LabInventory @relation(fields: [inventoryId], references: [id])
  
  @@index([hospitalId])
  @@index([inventoryId])
}

// ==================== BILLING ====================

model Bill {
  id          String   @id @default(uuid())
  hospitalId  String
  billId      String   @unique  // e.g., "BILL-00123"
  patientId   String
  patientName String
  type        String   // Consultation, Laboratory, Procedure, etc.
  category    String?  // OPD, IPD, Emergency
  description String?
  amount      Float
  status      String   @default("pending")  // pending, paid, cancelled
  paymentMethod String? // Cash, Insurance, Mobile Money, etc.
  paymentDate DateTime?
  receiptId   String?
  paidAt      String?  // Department that collected payment
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  
  @@index([hospitalId])
  @@index([patientId])
  @@index([billId])
}

// ==================== SERVICES ====================

model Service {
  id          String   @id @default(uuid())
  hospitalId  String
  serviceId   String   @unique  // e.g., "SRV-001"
  name        String
  category    String   // Consultation, Laboratory, Radiology, etc.
  description String?
  price       Float
  duration    Int?     // Duration in minutes
  department  String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  
  @@index([hospitalId])
  @@index([category])
}

// ==================== QUEUE MANAGEMENT ====================

model QueueEntry {
  id          String   @id @default(uuid())
  hospitalId  String
  queueNumber String
  patientId   String
  patientName String
  department  String   // Doctor, Laboratory, Pharmacy, etc.
  service     String
  priority    String   @default("Normal")  // Emergency, Urgent, Normal
  status      String   @default("Waiting")  // Waiting, Called, InService, Completed, Cancelled
  checkInTime DateTime @default(now())
  serviceStartTime DateTime?
  serviceEndTime DateTime?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  
  @@index([hospitalId])
  @@index([status])
  @@index([department])
}

// ==================== CASES ====================

model Case {
  id          String   @id @default(uuid())
  hospitalId  String
  caseId      String   @unique  // e.g., "CASE-2024-0001"
  patientId   String
  patientName String
  status      String   @default("Open")  // Open, Closed
  startDate   String
  endDate     String?
  type        String   // OPD, IPD, Emergency
  department  String
  chiefComplaint String?
  assignedDoctorId String?
  assignedDoctorName String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  
  @@index([hospitalId])
  @@index([patientId])
  @@index([status])
}

// ==================== BED MANAGEMENT ====================

// ==================== INVENTORY ====================

model InventoryItem {
  id          String   @id @default(uuid())
  hospitalId  String
  itemId      String   @unique  // e.g., "INV-001"
  name        String
  category    String   // Medication, Consumable, Equipment
  quantity    Int
  unit        String   // Tablets, Bottles, Pieces, etc.
  reorderLevel Int
  batchNumber String?
  expiryDate  DateTime?
  supplier    String?
  costPerUnit Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  
  @@index([hospitalId])
  @@index([category])
}

// ==================== BLOOD BANK ====================

model BloodInventory {
  id          String   @id @default(uuid())
  hospitalId  String
  bloodGroup  String   // A+, A-, B+, B-, AB+, AB-, O+, O-
  units       Int      @default(0)
  status      String   @default("Good") // Good, Low, Critical
  lastUpdated DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@unique([hospitalId, bloodGroup])
  @@index([hospitalId])
}

model BloodDonor {
  id          String   @id @default(uuid())
  hospitalId  String
  donorId     String   @unique // e.g., "D-1001"
  name        String
  bloodGroup  String
  age         Int
  gender      String
  contact     String
  lastDonation DateTime?
  status      String   @default("Eligible") // Eligible, Ineligible
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
}

model BloodRequest {
  id          String   @id @default(uuid())
  hospitalId  String
  requestId   String   @unique // e.g., "BR-001"
  patientId   String
  patientName String
  bloodGroup  String
  units       Int
  urgency     String   // Normal, Urgent, Critical
  status      String   @default("Pending") // Pending, Approved, Rejected, Completed
  requestDate DateTime @default(now())
  doctorName  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
  @@index([status])
}

// ==================== AMBULANCE ====================

model Ambulance {
  id          String   @id @default(uuid())
  hospitalId  String
  vehicleNumber String @unique
  type        String   // BLS, ALS, Transport
  status      String   @default("Available") // Available, On Mission, Maintenance
  location    String?
  fuel        Int      @default(100)
  assignedDriver String?
  assignedParamedic String?
  nextMaintenanceDue DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
}

model AmbulanceRequest {
  id          String   @id @default(uuid())
  hospitalId  String
  requestId   String   @unique
  patientName String
  pickupLocation String
  destination String?
  priority    String   // Low, Medium, High, Critical
  status      String   @default("Pending") // Pending, Dispatched, Completed, Cancelled
  contactNumber String?
  assignedAmbulanceId String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
}

model AmbulanceTrip {
  id          String   @id @default(uuid())
  hospitalId  String
  tripId      String   @unique
  requestId   String
  ambulanceId String
  driver      String?
  paramedic   String?
  startTime   DateTime
  endTime     DateTime?
  distance    Float?
  status      String   @default("In Progress")
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
}

// ==================== HR & PAYROLL ====================

model Employee {
  id          String   @id @default(uuid())
  hospitalId  String
  employeeId  String   @unique // e.g., "EMP-001"
  firstName   String
  lastName    String
  email       String   @unique
  phone       String?
  role        String   // Doctor, Nurse, Admin, Staff
  department  String
  status      String   @default("Active") // Active, On Leave, Terminated
  joinDate    DateTime
  salary      Float
  bankAccount String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  attendance  Attendance[]
  payroll     Payroll[]
  leaveRequests LeaveRequest[]

  @@index([hospitalId])
  @@index([department])
}

model Attendance {
  id          String   @id @default(uuid())
  hospitalId  String
  employeeId  String
  date        DateTime
  status      String   // Present, Absent, Late, Half-day
  checkIn     DateTime?
  checkOut    DateTime?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  employee    Employee @relation(fields: [employeeId], references: [id])

  @@index([hospitalId])
  @@index([employeeId])
  @@index([date])
}

model LeaveRequest {
  id          String   @id @default(uuid())
  hospitalId  String
  employeeId  String
  type        String   // Sick, Vacation, Personal
  startDate   DateTime
  endDate     DateTime
  reason      String?
  status      String   @default("Pending") // Pending, Approved, Rejected
  approvedBy  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  employee    Employee @relation(fields: [employeeId], references: [id])

  @@index([hospitalId])
  @@index([employeeId])
}

// ==================== BED MANAGEMENT (EXTENDED) ====================

// ==================== THEATRE / SURGERY ====================

model OperatingRoom {
  id          String   @id @default(uuid())
  hospitalId  String
  name        String
  type        String   // General, Cardiac, Orthopedic
  status      String   @default("Available") // Available, In Use, Cleaning, Maintenance
  equipment   Json?    // Array of equipment names
  surgeries   Surgery[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
}

model Surgery {
  id          String   @id @default(uuid())
  hospitalId  String
  patientId   String
  patientName String
  roomId      String
  room        OperatingRoom @relation(fields: [roomId], references: [id])
  procedureName String
  surgeonId   String
  surgeonName String
  date        DateTime
  startTime   String
  endTime     String?
  status      String   @default("Scheduled") // Scheduled, In Progress, Completed, Cancelled
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
  @@index([patientId])
  @@index([roomId])
  @@index([surgeonId])
}

// ==================== INSURANCE ====================

model InsuranceProvider {
  id          String   @id @default(uuid())
  name        String
  type        String   // Private, Public, HMO
  coverageTypes String[] // Outpatient, Inpatient, Dental, Optical
  apiEnabled  Boolean  @default(false)
  email       String?
  phone       String?
  website     String?
  status      String   @default("Active")
  hospitalId  String
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  claims      InsuranceClaim[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([hospitalId])
}

model InsuranceClaim {
  id            String   @id @default(uuid())
  providerId    String
  provider      InsuranceProvider @relation(fields: [providerId], references: [id])
  patientId     String
  patientName   String   // Snapshot in case patient record changes
  memberNumber  String
  service       String
  amount        Float
  status        String   // Pending, Approved, Rejected, Processing
  notes         String?
  submissionDate DateTime @default(now())
  hospitalId    String
  hospital      Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
  @@index([providerId])
  @@index([patientId])
}

// ==================== WALLET ====================

model Payroll {
  id          String   @id @default(uuid())
  hospitalId  String
  employeeId  String
  month       String   // e.g., "2024-01"
  basicSalary Float
  allowances  Float    @default(0)
  deductions  Float    @default(0)
  netSalary   Float
  status      String   @default("Pending") // Pending, Processed, Paid
  paymentDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  employee    Employee @relation(fields: [employeeId], references: [id])

  @@index([hospitalId])
  @@index([employeeId])
  @@index([month])
}

// ==================== EMR (Electronic Medical Records) ====================

model MedicalRecord {
  id              String   @id @default(uuid())
  hospitalId      String
  patientId       String
  recordType      String   // Consultation, Diagnosis, Procedure, Test Result
  title           String
  description     String   @db.Text
  diagnosis       String?
  treatment       String?  @db.Text
  doctorId        String
  doctorName      String
  department      String?
  date            DateTime @default(now())
  attachments     Json?    // Array of file references: [{filename, url, type, size}]
  vitals          Json?    // {bloodPressure, temperature, heartRate, etc}
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
  @@index([patientId])
  @@index([doctorId])
  @@index([date])
}

model ClinicalNote {
  id              String   @id @default(uuid())
  hospitalId      String
  patientId       String
  noteType        String   // Progress Note, Discharge Summary, Consultation Note
  content         String   @db.Text
  authorId        String
  authorName      String
  authorRole      String   // Doctor, Nurse, etc.
  date            DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
  @@index([patientId])
  @@index([date])
}

// ==================== MATERNITY ====================

model MaternityPatient {
  id              String   @id @default(uuid())
  hospitalId      String
  patientId       String   @unique
  patientName     String
  edd             DateTime // Expected Delivery Date
  gravida         Int      // Number of pregnancies
  para            Int      // Number of births
  bloodGroup      String?
  riskLevel       String   @default("Low") // Low, Medium, High
  status          String   @default("Antenatal") // Antenatal, Labor, Postnatal, Discharged
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])
  patient         Patient  @relation(fields: [patientId], references: [id])
  ancVisits       ANCVisit[]
  deliveries      Delivery[]
  pncVisits       PNCVisit[]

  @@index([hospitalId])
  @@index([patientId])
}

model ANCVisit {
  id              String   @id @default(uuid())
  hospitalId      String
  maternityPatientId String
  visitNumber     Int
  visitDate       DateTime @default(now())
  gestationalAge  Int      // Weeks
  weight          Float?
  bloodPressure   String?
  fundalHeight    Float?   // cm
  fetalHeartRate  Int?     // bpm
  complaints      String?
  examination     String?
  nextVisitDate   DateTime?
  attendedBy      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])
  maternityPatient MaternityPatient @relation(fields: [maternityPatientId], references: [id])

  @@index([hospitalId])
  @@index([maternityPatientId])
}

model Delivery {
  id              String   @id @default(uuid())
  hospitalId      String
  maternityPatientId String
  deliveryDate    DateTime @default(now())
  deliveryTime    String
  deliveryType    String   // Normal, C-Section, Assisted
  outcome         String   // Live Birth, Stillbirth
  complications   String?
  attendedBy      String
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])
  maternityPatient MaternityPatient @relation(fields: [maternityPatientId], references: [id])
  newborns        Newborn[]

  @@index([hospitalId])
  @@index([maternityPatientId])
}

model Newborn {
  id              String   @id @default(uuid())
  hospitalId      String
  deliveryId      String
  gender          String
  weight          Float    // kg
  apgarScore1     Int?
  apgarScore5     Int?
  status          String   @default("Healthy") // Healthy, NICU, Deceased
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])
  delivery        Delivery @relation(fields: [deliveryId], references: [id])

  @@index([hospitalId])
  @@index([deliveryId])
}

model PNCVisit {
  id              String   @id @default(uuid())
  hospitalId      String
  maternityPatientId String
  visitDate       DateTime @default(now())
  daysPostpartum  Int
  motherCondition String?
  babyCondition   String?
  complications   String?
  attendedBy      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])
  maternityPatient MaternityPatient @relation(fields: [maternityPatientId], references: [id])

  @@index([hospitalId])
  @@index([maternityPatientId])
}

// ==================== TRIAGE ====================

model TriageRecord {
  id              String   @id @default(uuid())
  hospitalId      String
  patientId       String
  visitId         String?  // Optional link to an appointment or queue entry
  vitals          Json     // { bp, temp, hr, spo2, weight, height, bmi, respRate }
  chiefComplaint  String?
  priority        String   @default("Normal") // Normal, Urgent, Emergency
  notes           String?
  nurseId         String
  nurseName       String
  status          String   @default("Completed")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  hospital        Hospital @relation(fields: [hospitalId], references: [id])
  patient         Patient  @relation(fields: [patientId], references: [id])

  @@index([hospitalId])
  @@index([patientId])
  @@index([createdAt])
}

// ==================== BED MANAGEMENT ====================

model Ward {
  id          String   @id @default(uuid())
  hospitalId  String
  name        String
  type        String   // General, Private, ICU, Maternity, Pediatric
  gender      String   // Male, Female, Mixed
  capacity    Int
  description String?
  status      String   @default("Active") // Active, Maintenance, Closed
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  beds        Bed[]

  @@index([hospitalId])
}

model Bed {
  id          String   @id @default(uuid())
  hospitalId  String
  wardId      String
  number      String
  type        String   // Standard, Adjustable, ICU, Incubator
  status      String   @default("Available") // Available, Occupied, Cleaning, Maintenance
  price       Float    @default(0)
  features    String[] // Oxygen, Monitor, etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  ward        Ward     @relation(fields: [wardId], references: [id])
  admissions  Admission[]

  @@index([hospitalId])
  @@index([wardId])
}

model Admission {
  id          String   @id @default(uuid())
  hospitalId  String
  patientId   String
  bedId       String
  admissionDate DateTime @default(now())
  dischargeDate DateTime?
  diagnosis   String?
  reason      String?  // Reason for admission
  admittedBy  String   // Doctor/Nurse ID
  dischargedBy String? // Doctor ID
  status      String   @default("Admitted") // Admitted, Discharged, Transferred
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  patient     Patient  @relation(fields: [patientId], references: [id])
  bed         Bed      @relation(fields: [bedId], references: [id])

  @@index([hospitalId])
  @@index([patientId])
  @@index([bedId])
  @@index([status])
}

// ==================== FINANCE ====================

model Expense {
  id          String   @id @default(uuid())
  hospitalId  String
  category    String   // Utilities, Supplies, Salaries, Maintenance, Other
  description String
  amount      Float
  date        DateTime @default(now())
  status      String   @default("Pending") // Pending, Approved, Paid
  requestedBy String?  // User ID
  approvedBy  String?  // User ID
  approvedDate DateTime?
  paidDate    DateTime?
  paymentMethod String?
  reference   String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])

  @@index([hospitalId])
  @@index([category])
  @@index([status])
  @@index([date])
}

// ==================== MEDICAL CAMPS ====================

model MedicalCamp {
  id          String   @id @default(uuid())
  hospitalId  String
  name        String
  location    String
  startDate   DateTime
  endDate     DateTime
  description String?
  organizer   String
  services    String[] // Array of services offered
  status      String   @default("Scheduled") // Scheduled, Ongoing, Completed, Cancelled
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  patients    CampPatient[]

  @@index([hospitalId])
  @@index([status])
  @@index([startDate])
}

model CampPatient {
  id          String   @id @default(uuid())
  campId      String
  patientId   String
  servicesReceived String[] // Array of services received
  registeredAt DateTime @default(now())
  notes       String?
  createdAt   DateTime @default(now())

  // Relations
  camp        MedicalCamp @relation(fields: [campId], references: [id])
  patient     Patient     @relation(fields: [patientId], references: [id])

  @@index([campId])
  @@index([patientId])
}

